<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSL 고교선택적성검사 결과</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="js/dataProcessor.js"></script>
    <script src="js/data.js"></script>
    <script src="js/statisticsProcessor.js"></script>
    <script src="js/highSchoolRecommendation.js"></script>
    <script src="js/universityStrategy.js"></script>
    <script src="js/admissionRoadmap.js"></script>
    <script src="js/academicImprovement.js"></script>
    <script src="js/overallAssessment.js"></script>
    <link rel="stylesheet" href="css/navy-theme.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }

        h1, h2 {
            color: #333;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #5A3A22;
            padding-bottom: 10px;
        }

        h2 {
            margin-top: 40px;
            margin-bottom: 20px;
            border-left: 5px solid #5A3A22;
            padding-left: 10px;
        }

        #loading, #error {
            text-align: center;
            padding: 20px;
            font-size: 18px;
        }

        #error {
            color: #dc3545;
            font-weight: bold;
        }

        .student-info {
            display: flex;
            flex-wrap: wrap;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }

        .student-info-item {
            flex: 1 1 200px;
            margin: 10px;
            padding: 5px;
        }

        .student-info-item strong {
            font-weight: bold;
            display: inline-block;
            width: 100px;
        }

        .chart-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
            height: 400px;
            position: relative;
        }

        .radar-chart-container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
            height: 600px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .normal-dist-charts {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .normal-chart-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            height: 300px;
            position: relative;
        }

        .scale-data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .scale-data-table th, .scale-data-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .scale-data-table th {
            background-color: #5A3A22;
            color: white;
            font-weight: bold;
        }

        .scale-data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .scale-data-table tr:hover {
            background-color: #f1f1f1;
        }

        @media (max-width: 768px) {
            .normal-dist-charts {
                grid-template-columns: 1fr;
            }
            .student-info-item {
                flex: 1 1 100%;
            }
            .scale-data-table {
                font-size: 14px;
            }
            .scale-data-table th, .scale-data-table td {
                padding: 8px;
            }
            .radar-chart-container {
                height: 400px; /* 모바일에서 더 적합한 높이로 조정 */
                padding: 10px;
            }
            .chart-container {
                height: 350px; /* 다른 차트도 모바일에 맞게 조정 */
            }
        }
    </style>
</head>
<body>
    <h1>SSL 고교선택적성검사 결과</h1>
    
    <div id="loading">데이터를 불러오는 중...</div>
    <div id="error" style="display: none;"></div>
    
    <div id="report-content" style="display: none;">
        <!-- 학생 정보 섹션 -->
        <div class="student-info">
            <div class="student-info-item">
                <strong>학생 ID:</strong> <span id="studentId"></span>
            </div>
            <div class="student-info-item">
                <strong>학생명:</strong> <span id="studentName"></span>
            </div>
            <div class="student-info-item">
                <strong>출신학교:</strong> <span id="studentSchool"></span>
            </div>
            <div class="student-info-item">
                <strong>검사일:</strong> <span id="testDate"></span>
            </div>
        </div>
        
        <!-- 1. 고교적성 6척도 절대점수 프로파일 -->
        <h2>1. 고교선택적성 6척도 결과</h2>
        <div class="radar-chart-container">
            <canvas id="radarChart"></canvas>
        </div>
        
        <!-- 2. 고교적성 6척도 점수 요약 -->
        <h2>2. 고교선택적성 6척도 점수</h2>
        <table class="scale-data-table">
            <thead>
                <tr>
                    <th>척도</th>
                    <th>총점<br>(200점 만점)</th>
                    <th>평균점수<br>(5점 만점)</th>
                    <th>Z점수</th>
                    <th>백분위</th>
                    <th>상위</th>
                </tr>
            </thead>
            <tbody id="scaleTableBody">
                <!-- 동적으로 채워짐 -->
            </tbody>
        </table>
        
        <!-- 3. 고교적성 6척도 상대점수 -->
        <h2>3. 고교선택적성 6척도 상대점수</h2>
        <div class="normal-dist-charts">
            <div class="normal-chart-container">
                <canvas id="selfRegulationChart"></canvas>
            </div>
            <div class="normal-chart-container">
                <canvas id="extracurricularChart"></canvas>
            </div>
            <div class="normal-chart-container">
                <canvas id="internalAcademicChart"></canvas>
            </div>
            <div class="normal-chart-container">
                <canvas id="languageProcessingChart"></canvas>
            </div>
            <div class="normal-chart-container">
                <canvas id="engineeringThinkingChart"></canvas>
            </div>
            <div class="normal-chart-container">
                <canvas id="medicalAptitudeChart"></canvas>
            </div>
        </div>
        
        <!-- 4. 입시성향분석 - 교과형 vs 종합형, 서류형 vs 면접형 -->
        <h2>4. 입시성향분석 - 교과형 vs 종합형, 서류형 vs 면접형</h2>
        <div class="chart-container" style="height: 900px; padding-bottom: 300px; margin-bottom: 100px;">
            <!-- 분석 결과 수치 표시 -->
            <div id="quadrantAnalysisData" style="margin-bottom: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 8px; width: 90%; margin-left: auto; margin-right: auto;">
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px;">
                    <tr style="border-bottom: 1px solid #ddd;">
                        <th style="text-align: left; padding: 8px; width: 25%;">구분</th>
                        <th style="text-align: center; padding: 8px; width: 25%;">좌표값</th>
                        <th style="text-align: center; padding: 8px; width: 25%;">백분위</th>
                        <th style="text-align: center; padding: 8px; width: 25%;">해석</th>
                    </tr>
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="text-align: left; padding: 8px; font-weight: bold;">교과형(-) ↔ 종합형(+)</td>
                        <td id="xCoordValue" style="text-align: center; padding: 8px;">-</td>
                        <td id="xPercentileValue" style="text-align: center; padding: 8px;">-</td>
                        <td id="xInterpretation" style="text-align: center; padding: 8px;">-</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 8px; font-weight: bold;">면접형(-) ↔ 서류형(+)</td>
                        <td id="yCoordValue" style="text-align: center; padding: 8px;">-</td>
                        <td id="yPercentileValue" style="text-align: center; padding: 8px;">-</td>
                        <td id="yInterpretation" style="text-align: center; padding: 8px;">-</td>
                    </tr>
                </table>
            </div>
            
            <canvas id="quadrantChart" style="margin-bottom: 30px;"></canvas>
            
            <div style="margin-top: 10px; margin-bottom: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 8px; width: 90%; margin-left: auto; margin-right: auto;">
                <p style="margin: 0; color: #555; font-size: 14px; text-align: left; line-height: 1.5;">
                    교과형/종합형과 서류형/면접형 중 학생에게 더 유리한 입시전형 성향을 분석하며 향후 고교 활동 및 대입 준비 방향을 설정하는 기준으로 활용할 수 있습니다.
                </p>
            </div>
        </div>
        
        <!-- 5. 학업성취도 분석 -->
        <h2>5. 학업성취도 분석</h2>
        <div class="chart-container">
            <canvas id="academicChart"></canvas>
        </div>
        
        <!-- 6. 고교 추천 결과 -->
        <h2>6. 진학고교추천</h2>
        <div class="school-recommendation-container" style="background-color: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); padding: 20px; margin-bottom: 30px;">
            <table class="scale-data-table" id="recommendationTable">
                <thead>
                    <tr>
                        <th>지망</th>
                        <th>추천 고등학교</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>1지망</strong></td>
                        <td id="firstChoice">분석 중...</td>
                    </tr>
                    <tr>
                        <td><strong>2지망</strong></td>
                        <td id="secondChoice">분석 중...</td>
                    </tr>
                </tbody>
            </table>
            
            <!-- 추가 평가 정보 -->
            <div style="margin-top: 25px; padding: 15px; background-color: #f9f9f9; border-radius: 8px;">
                <h3 style="font-size: 16px; margin-bottom: 15px; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 8px;">추천 근거</h3>
                <ul style="list-style-type: none; padding: 0; margin: 0;">
                    <li style="padding: 8px 0; border-bottom: 1px dotted #eee;">
                        <strong>합격가능성 평가:</strong> <span id="admissionPossibility">분석 중...</span>
                    </li>
                    <li style="padding: 8px 0; border-bottom: 1px dotted #eee;">
                        <strong>학업성취도 평가:</strong> <span id="academicEvaluation">분석 중...</span>
                    </li>
                    <li style="padding: 8px 0;">
                        <strong>대입전형 평가:</strong> <span id="admissionTypeEvaluation">분석 중...</span>
                    </li>
                </ul>
            </div>
            
            <p style="margin-top: 15px; color: #666; font-size: 14px; text-align: center;">
                * 이 추천 결과는 학생의 적성과 학업 성취도를 바탕으로 한 참고용 정보입니다.
            </p>
        </div>
        
        <!-- 7. 대입전략 수립 -->
        <h2>7. 대입계열추천 및 전략</h2>
        <div class="university-strategy-container" style="background-color: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); padding: 20px; margin-bottom: 30px;">
            <table class="scale-data-table" id="strategyTable">
                <thead>
                    <tr>
                        <th>순위</th>
                        <th>추천 계열</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>1순위</strong></td>
                        <td id="firstStrategy">분석 중...</td>
                    </tr>
                    <tr>
                        <td><strong>2순위</strong></td>
                        <td id="secondStrategy">분석 중...</td>
                    </tr>
                </tbody>
            </table>
            
            <!-- 추천 근거 설명 -->
            <div style="margin-top: 25px; padding: 15px; background-color: #f9f9f9; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="font-size: 16px; margin-bottom: 15px; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 8px;">계열 추천 근거</h3>
                <ul style="list-style-type: none; padding: 0; margin: 0;">
                    <li style="padding: 8px 0; border-bottom: 1px dotted #eee;">
                        <strong>언어정보처리능력:</strong> <span id="languageScore">분석 중...</span> 
                    </li>
                    <li style="padding: 8px 0; border-bottom: 1px dotted #eee;">
                        <strong>공학적사고력:</strong> <span id="engineeringScore">분석 중...</span> 
                    </li>
                    <li style="padding: 8px 0; border-bottom: 1px dotted #eee;">
                        <strong>의약학적성:</strong> <span id="medicalScore">분석 중...</span> 
                    </li>
                </ul>
                
                <div style="margin-top: 15px; padding: 10px; background-color: #f0f0f0; border-radius: 6px;">
                    <p id="recommendationExplanation" style="margin: 0; line-height: 1.5; color: #333;">분석 중...</p>
                    <p id="potentialMessage" style="margin-top: 10px; font-style: italic; color: #555;">분석 중...</p>
                </div>
            </div>
            
            <!-- 대입전략 상세 내용 -->
            <div style="margin-top: 20px;">
                <div style="background-color: #f9f9f9; border-radius: 8px; padding: 20px;">
                    <h3 style="font-size: 16px; margin: 0 0 15px 0; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 8px;">교과전형 대비 전략</h3>
                    <p style="line-height: 1.6; margin: 0 0 10px 0;">
                        내면학업수행능력이 <strong>상위 43% 수준</strong>으로, 교과전형 성공을 위해서는 학습 루틴을 체계화하고
                        고교 1학년 내신 관리에 특히 집중해야 합니다. 주요교과(국영수과)의 A등급 비율을 높이는 것이 가장 중요합니다.
                    </p>
                    <p style="line-height: 1.6; margin: 0;">
                        우수 대학의 교과전형은 성적 외에도 세부능력특기사항(교과세특)을 평가하므로, 수행평가를 통해 '문제해결력', '교과내용 재구성' 등의 키워드가 기록되도록 관리해야 합니다.
                    </p>
                </div>
                <div style="background-color: #f9f9f9; border-radius: 8px; padding: 20px; margin-bottom: 15px;">
                    <h3 style="font-size: 16px; margin: 0 0 15px 0; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 8px;">학생부종합전형 대비 전략</h3>
                    <p style="line-height: 1.6; margin: 0 0 10px 0;">
                        비교과수행능력이 <strong>상위 18% 수준</strong>으로 학생부종합전형 성공을 위해서는 생기부에 "융합적 사고력"과 "문제해결력"이 드러나는 활동이 필수적입니다.
                    </p>
                    <p style="line-height: 1.6; margin: 0;">
                        소논문 작성, 교내 학술대회 참여, 주요 교과목 발표 활동 등을 통해 학생부 기록을 체계적으로 관리하며,
                        진로 관련 독서활동을 통해 인성과 발전가능성 평가요소도 함께 준비해야 합니다.
                    </p>
                </div>
                
                <!-- 대입 역량 그라데이션 차트 -->
                <div style="margin-top: 25px; padding: 15px; background-color: #f9f9f9; border-radius: 8px;">
                    <h3 style="font-size: 16px; margin: 0 0 15px 0; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 8px;">학생부 관리 스펙트럼</h3>
                    
                    <!-- 첫 번째 그라데이션 바 -->
                    <div style="margin-bottom: 30px; position: relative;">
                        <div style="height: 40px; background: linear-gradient(to right, #2B4C7E, #FFFFFF); border-radius: 4px; margin-bottom: 10px; position: relative;">
                            <!-- 학생 위치 표시 화살표 -->
                            <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%);">
                                <div style="color: #FF0000; font-size: 24px; font-weight: bold;">↓</div>
                                <div style="color: #FF0000; font-size: 12px; font-weight: bold;">해당위치</div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <div style="text-align: left; font-weight: bold; font-size: 14px;">활동의 확장성 및 심화탐구능력(A)</div>
                            <div style="text-align: right; font-weight: bold; font-size: 14px;">활동의 안정성 및 교과 내 탐구능력(B)</div>
                        </div>
                        <p style="margin-top: 10px; font-size: 13px; line-height: 1.5; color: #555;">
                            활동의 확장성 및 심화탐구능력이 높을수록, 진로역량 배점을 높일 수 있는 발표, 보고서 활동을 추천합니다. 반면, 활동의 안정성 및 교과 내 탐구능력이 높을수록 교과 내 개념을 충실히 기입하는 활동이 주가 됩니다.
                        </p>
                    </div>
                    
                    <!-- 두 번째 그라데이션 바 -->
                    <div style="position: relative;">
                        <div style="height: 40px; background: linear-gradient(to right, #2B4C7E, #FFFFFF); border-radius: 4px; margin-bottom: 10px; position: relative;">
                            <!-- 학생 위치 표시 화살표 -->
                            <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%);">
                                <div style="color: #FF0000; font-size: 24px; font-weight: bold;">↓</div>
                                <div style="color: #FF0000; font-size: 12px; font-weight: bold;">해당위치</div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <div style="text-align: left; font-weight: bold; font-size: 14px;">수행평가 및 <span style="text-decoration: underline;">비</span>교과 활동 중요성</div>
                            <div style="text-align: right; font-weight: bold; font-size: 14px;">교과성취도 및 이수과목의 중요성</div>
                        </div>
                        <p style="margin-top: 10px; font-size: 13px; line-height: 1.5; color: #555;">
                            수행평가 및 비교과 활동 중요성이 높을수록 교과보다 종합전형에 적합한 학생이며 수행활동에 적극적 태도가 필요합니다. 반면, 교과성취도 및 이수과목 중요성이 높을수록 교과형, 추천형에 적합하며 GPA 중심 학습전략이 효과적입니다.
                        </p>
                    </div>
                </div>
            </div>
            
            <p style="margin-top: 15px; color: #666; font-size: 14px; text-align: center;">
                * 이 대입전략은 학생의 고교적성과 입시성향, 학업 성취도를 바탕으로 한 참고용 정보입니다.
            </p>
        </div>
        
        <!-- 8번, 9번, 10번 항목 삭제됨 -->
    </div>
    
    <script>
        // 기본 설정
        Chart.register(ChartDataLabels);
        
        // URL 파라미터 가져오기
        const urlParams = new URLSearchParams(window.location.search);
        const studentId = urlParams.get('id');
        const studentName = urlParams.get('name');
        
        // DOM 요소
        const loadingDiv = document.getElementById('loading');
        const errorDiv = document.getElementById('error');
        const reportContentDiv = document.getElementById('report-content');
        
        // 메인 코드
        if (!studentId || !studentName) {
            window.location.href = 'index.html';
        } else {
            // 데이터 로드 시작 시 로딩 표시
            loadingDiv.style.display = 'block';
            reportContentDiv.style.display = 'none';
            
            // data.js의 getStudentData 함수 사용
            getStudentData(studentId, studentName)
                .then(studentData => {
                    // 학생 기본 정보 표시
                    document.getElementById('studentId').textContent = studentData.id;
                    document.getElementById('studentName').textContent = studentData.name;
                    document.getElementById('studentSchool').textContent = studentData.school;
                    document.getElementById('testDate').textContent = studentData.testDate;
                    
                    // UI 업데이트
                    loadingDiv.style.display = 'none';
                    reportContentDiv.style.display = 'block';
                    
                    // 차트 생성
                    createRadarChart(studentData);
                    createNormalDistCharts(studentData);
                    updateScaleTable(studentData);
                    createQuadrantChart(studentData);
                    createAcademicChart(studentData);
                    
                    // 고교 추천 결과 처리 (2지망까지만)
                    const recommendations = getHighSchoolRecommendations(studentData);
                    const firstChoice = document.getElementById('firstChoice');
                    const secondChoice = document.getElementById('secondChoice');
                    
                    firstChoice.textContent = recommendations[1] || '조건에 맞는 추천 없음';
                    secondChoice.textContent = recommendations[2] || '조건에 맞는 추천 없음';
                    
                    // 추천 학교 텍스트 스타일 적용
                    firstChoice.style.fontWeight = 'bold';
                    secondChoice.style.fontWeight = 'bold';
                    
                    // 추가 평가 정보 채우기
                    // 1. 합격가능성 평가 - B등급과목 개수에 따라 다른 문구 표시
                    const admissionPossibilityEl = document.getElementById('admissionPossibility');
                    if (studentData.bGradeCount === 0) {
                        admissionPossibilityEl.textContent = `내신 성적 중 B등급과목 ${studentData.bGradeCount}개로 지망 학교 지원 시 충분한 합격가능성이 있습니다.`;
                    } else {
                        admissionPossibilityEl.textContent = `내신 성적 중 B등급과목 ${studentData.bGradeCount}개로 전략적인 지망 학교 선정 필요성이 있습니다.`;
                    }
                    
                    // 2. 학업성취도 평가 - 실제 통계 기반 계산값과 조건부 문구 활용
                    const englishPercentile = calculatePercentile(studentData.academicData.english.zScore);
                    const mathPercentile = calculatePercentile(studentData.academicData.math.zScore);
                    const englishRank = Math.min(99, Math.max(1, Math.round(100 - englishPercentile)));
                    const mathRank = Math.min(99, Math.max(1, Math.round(100 - mathPercentile)));
                    
                    // 상위 30% 기준점
                    const isEnglishGood = englishRank <= 30;  // 영어 상위 30% 이내
                    const isMathGood = mathRank <= 30;        // 수학 상위 30% 이내
                    
                    const academicEvaluationEl = document.getElementById('academicEvaluation');
                    
                    // 조건에 따른 문구 선택
                    let evaluationText = '';
                    if (isEnglishGood && isMathGood) {
                        evaluationText = "지망 고등학교 진학 후에도 우수한 성적 관리가 가능할 것으로 예상됩니다.";
                    } else if (!isEnglishGood && isMathGood) {
                        evaluationText = "지망 고등학교 진학 후에도 성적 관리를 위해 영어교과 보충심화가 필요합니다.";
                    } else if (isEnglishGood && !isMathGood) {
                        evaluationText = "지망 고등학교 진학 후에도 성적 관리를 위해 수학교과 보충심화가 필요합니다.";
                    } else { // 둘 다 미만
                        evaluationText = "지망 고등학교 진학 후에도 성적 관리를 위해 영어 및 수학 교과 보충심화가 필요합니다.";
                    }
                    
                    academicEvaluationEl.textContent = `학업성취도가 영어, 수학 각각 전체 응시자 중 상위 ${englishRank}%, 상위 ${mathRank}%로, ${evaluationText}`;

                    // 3. 대입전형 평가 - 실제 통계 기반 계산값 활용
                    // quadrantData.x 값이 종합형(+)/교과형(-) 점수, y 값이 서류형(+)/면접형(-) 점수
                    const comprehensiveX = studentData.quadrantData.x;
                    const documentY = studentData.quadrantData.y;
                    
                    // 백분위 계산 및 1~99 범위 보장
                    const comprehensivePercentile = Math.min(99, Math.max(1, Math.round(((comprehensiveX + 25) / 50 * 100))));
                    const subjectPercentile = Math.min(99, Math.max(1, Math.round(((25 - comprehensiveX) / 50 * 100))));
                    
                    // 종합형과 교과형 비교하여 적절한 조언 문구 생성
                    const recommendationText = comprehensivePercentile > subjectPercentile 
                        ? '비교과활동을 적극적으로 공략하는 것이 유리합니다.'
                        : '교과활동을 적극적으로 공략하는 것이 유리합니다.';
                    
                    const admissionTypeEvaluationEl = document.getElementById('admissionTypeEvaluation');
                    admissionTypeEvaluationEl.textContent = `학생부종합전형 적합도 ${comprehensivePercentile}%, 학생부교과전형 적합도 ${subjectPercentile}%로, ${recommendationText}`;
                    
                    // 대입전략 결과 처리
                    const strategies = getUniversityStrategies(studentData);
                    const firstStrategy = document.getElementById('firstStrategy');
                    const secondStrategy = document.getElementById('secondStrategy');
                    
                    firstStrategy.textContent = strategies[1] || '조건에 맞는 추천 없음';
                    secondStrategy.textContent = strategies[2] || '조건에 맞는 추천 없음';
                    
                    // 전략 텍스트 스타일 적용 (볼드체)
                    firstStrategy.style.fontWeight = 'bold';
                    secondStrategy.style.fontWeight = 'bold';
                    
                    // 계열 추천 근거 점수 표시
                    const languageScore = studentData.scaleScores["languageProcessing"] || 0;
                    const engineeringScore = studentData.scaleScores["engineeringThinking"] || 0;
                    const medicalScore = studentData.scaleScores["medicalAptitude"] || 0;
                    
                    // 각 점수의 퍼센타일 계산
                    const languageZScore = studentData.scaleZScores["languageProcessing"] || 0;
                    const engineeringZScore = studentData.scaleZScores["engineeringThinking"] || 0;
                    const medicalZScore = studentData.scaleZScores["medicalAptitude"] || 0;
                    
                    const languagePercentile = calculatePercentile(languageZScore);
                    const engineeringPercentile = calculatePercentile(engineeringZScore);
                    const medicalPercentile = calculatePercentile(medicalZScore);
                    
                    // 상위 백분위 계산
                    const languageTopPercentile = (100 - languagePercentile).toFixed(1);
                    const engineeringTopPercentile = (100 - engineeringPercentile).toFixed(1);
                    const medicalTopPercentile = (100 - medicalPercentile).toFixed(1);
                    
                    // 추천 근거에 점수 및 백분위 표시
                    document.getElementById('languageScore').textContent = 
                        `${languageScore}점 (상위 ${languageTopPercentile}%)`;
                    
                    document.getElementById('engineeringScore').textContent = 
                        `${engineeringScore}점 (상위 ${engineeringTopPercentile}%)`;
                    
                    document.getElementById('medicalScore').textContent = 
                        `${medicalScore}점 (상위 ${medicalTopPercentile}%)`;
                    
                    // 점수 비교하여 순위 결정 및 설명 생성
                    const scoreData = [
                        { name: "언어정보처리능력", score: languageScore, field: "SKY인문사회계열", rank: null, percentile: parseFloat(languageTopPercentile) },
                        { name: "공학적사고력", score: engineeringScore, field: "SKY이공계열", rank: null, percentile: parseFloat(engineeringTopPercentile) },
                        { name: "의약학적성", score: medicalScore, field: "의치한약수 계열", rank: null, percentile: parseFloat(medicalTopPercentile) }
                    ];
                    
                    // 점수 기준 내림차순 정렬
                    scoreData.sort((a, b) => b.score - a.score);
                    
                    // 순위 할당
                    scoreData.forEach((item, index) => {
                        item.rank = index + 1;
                    });
                    
                    // 추천 근거 설명 생성
                    const topScore = scoreData[0];
                    const secondScore = scoreData[1];
                    const recommendationExplanation = document.getElementById('recommendationExplanation');
                    
                    recommendationExplanation.innerHTML = `
                        <strong>${topScore.name}</strong> 점수(${topScore.score}점)가 가장 높아 <strong>${topScore.field}</strong>을 1순위로, 
                        <strong>${secondScore.name}</strong> 점수(${secondScore.score}점)가 두 번째로 높아 <strong>${secondScore.field}</strong>을 2순위로 추천합니다.
                    `;
                    
                    // 상위 50% 이상인 경우 희망 계열 진학 가능성 문구 추가
                    const potentialMessage = document.getElementById('potentialMessage');
                    const above50Percent = scoreData.filter(item => item.percentile >= 50);
                    
                    if (above50Percent.length > 0) {
                        const fields = above50Percent.map(item => `<strong>${item.field}</strong>`).join(', ');
                        potentialMessage.innerHTML = `
                            ${fields} 적성 점수가 상위 50% 이상으로, 학생이 희망하는 경우 해당 계열로 진학이 가능합니다.
                        `;
                    } else {
                        potentialMessage.innerHTML = `
                            모든 계열의 적성 점수가 상위 50% 미만으로, 희망 계열 진학을 위해서는 추가적인 학습이 필요합니다.
                        `;
                    }
                    
                    // 입시 로드맵 코드 제거됨
                    
                    console.log('학생 데이터 로드 완료: ', studentData.name);
                })
                .catch(error => {
                    loadingDiv.style.display = 'none';
                    errorDiv.style.display = 'block';
                    errorDiv.innerText = error.message || '학생 정보를 찾을 수 없습니다.';
                    console.error('데이터 로드 오류:', error);
                });
        }
        
        // 방사형 차트 생성 함수
        function createRadarChart(studentData) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            // 5점 만점 점수 사용
            const averageScores = SCALES.map(scale => studentData.scaleScores5[scale.key]);
            
            // 파스텔톤 색상 정의
            const pastelBlue = 'rgba(116, 185, 255, 0.5)';
            const pastelColors = [
                'rgba(116, 185, 255, 1)',    // 파스텔 블루
                'rgba(162, 222, 208, 1)',    // 파스텔 민트
                'rgba(153, 102, 255, 1)',    // 파스텔 퍼플
                'rgba(255, 205, 86, 1)',     // 파스텔 옐로우
                'rgba(255, 159, 64, 1)',     // 파스텔 오렌지
                'rgba(201, 203, 207, 1)'     // 파스텔 그레이
            ];
            
            // 모바일인지 확인
            const isMobile = window.innerWidth <= 768;
            
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: SCALES.map(scale => scale.name),
                    datasets: [{
                        label: '5점 만점 평균',
                        data: averageScores,
                        backgroundColor: pastelBlue,
                        borderColor: 'rgb(85, 165, 240)',
                        pointBackgroundColor: pastelColors,
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(54, 162, 235)',
                        borderWidth: 1.5,
                        pointRadius: isMobile ? 4 : 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            min: 0,
                            max: 5,
                            ticks: { 
                                stepSize: 1,
                                color: 'rgba(0, 0, 0, 0.5)'
                            },
                            angleLines: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            pointLabels: {
                                color: '#333333',
                                font: {
                                    size: isMobile ? 12 : 16,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: '6척도 절대점수 프로파일',
                            color: '#333333',
                            font: { size: isMobile ? 14 : 18, weight: 'bold' }
                        },
                        legend: {
                            display: false
                        },
                        datalabels: {
                            color: '#333333',
                            backgroundColor: 'rgba(255, 255, 255, 0.7)',
                            borderRadius: 4,
                            formatter: (value) => value.toFixed(1),
                            font: { weight: 'bold', size: isMobile ? 10 : 12 }
                        }
                    }
                }
            });
        }
        
        // 정규분포 차트 생성 (Z-Score 기준)
        function createNormalDistCharts(studentData) {
            SCALES.forEach(scale => {
                const chartId = scale.key + 'Chart';
                const ctx = document.getElementById(chartId).getContext('2d');
                const zScore = studentData.scaleZScores[scale.key]; // Z점수 직접 사용
                const percentile = calculatePercentile(zScore);
                
                // Z-Score 기반으로 표준 정규분포 데이터 생성 (-3 ~ 3)
                const normalDistData = generateStandardNormalDistributionData(-3, 3, 100);
                // 학생의 Z-Score보다 큰 영역 (상위 영역)
                const studentAreaData = normalDistData.filter(point => point.x >= zScore);
                
                // 학생 위치 y값 계산 (표준정규분포 함수)
                const studentY = (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-(Math.pow(zScore, 2) / 2));
                
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        datasets: [
                            {
                                label: '정규분포',
                                data: normalDistData,
                                borderColor: 'rgba(100, 100, 100, 0.5)',
                                backgroundColor: 'rgba(100, 100, 100, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4,
                                pointRadius: 0
                            },
                            {
                                label: '상위 영역',
                                data: studentAreaData,
                                borderColor: scale.color,
                                backgroundColor: scale.color.replace('0.7', '0.3'),
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4,
                                pointRadius: 0
                            },
                            {
                                label: '학생 위치',
                                data: [{ x: zScore, y: studentY }],
                                backgroundColor: scale.color,
                                borderColor: scale.color,
                                pointRadius: 8,
                                pointHoverRadius: 10,
                                showLine: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                type: 'linear',
                                min: -3,
                                max: 3,
                                title: { display: true, text: 'Z-Score', font: { weight: 'bold' } }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: { display: false },
                                title: { display: true, text: '빈도', font: { weight: 'bold' } }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: scale.name,
                                font: { size: window.innerWidth <= 768 ? 14 : 16, weight: 'bold' }
                            },
                            subtitle: {
                                display: true,
                                text: `Z점수: ${zScore.toFixed(2)}, 백분위: ${percentile}%`,
                                font: { size: window.innerWidth <= 768 ? 10 : 12 }
                            },
                            datalabels: {
                                display: ctx => ctx.datasetIndex === 2,
                                color: '#000000',
                                backgroundColor: 'rgba(255, 255, 255, 0.7)',
                                borderRadius: 4,
                                padding: window.innerWidth <= 768 ? 2 : 4,
                                font: { weight: 'bold', size: window.innerWidth <= 768 ? 9 : 11 },
                                formatter: () => `상위 ${(100 - percentile).toFixed(1)}%`
                            }
                        }
                    }
                });
            });
        }
        
        // 표준 정규분포 데이터 생성 함수 (Z-Score 기준)
        function generateStandardNormalDistributionData(min, max, points) {
            const data = [];
            const step = (max - min) / points;
            
            for (let i = 0; i <= points; i++) {
                const x = min + (step * i); // Z-Score
                // 표준정규분포 함수 (평균 0, 표준편차 1)
                const y = (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-(Math.pow(x, 2) / 2));
                data.push({ x, y });
            }
            
            return data;
        }
        
        // 점수 테이블 업데이트
        function updateScaleTable(studentData) {
            const tableBody = document.getElementById('scaleTableBody');
            tableBody.innerHTML = '';
            
            SCALES.forEach(scale => {
                const score = studentData.scaleScores[scale.key];
                const averageScore = studentData.scaleScores5[scale.key]; // 5점 만점 점수 직접 사용
                const zScore = studentData.scaleZScores[scale.key]; // Z점수 직접 사용
                const percentile = calculatePercentile(zScore);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${scale.name}</td>
                    <td>${score}</td>
                    <td>${averageScore.toFixed(1)}</td>
                    <td>${zScore.toFixed(2)}</td>
                    <td>${percentile}%</td>
                    <td>상위 ${(100 - percentile).toFixed(1)}%</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // 사분면 차트 생성
        function createQuadrantChart(studentData) {
            const ctx = document.getElementById('quadrantChart').getContext('2d');
            
            // 좌표값 및 백분위 계산
            const xCoord = studentData.quadrantData.x;
            const yCoord = studentData.quadrantData.y;
            
            // 백분위 계산 (0~100 범위)
            const xPercentile = Math.min(99, Math.max(1, Math.round(((xCoord + 25) / 50 * 100))));
            const subjectPercentile = Math.min(99, Math.max(1, Math.round(((25 - xCoord) / 50 * 100))));
            const yPercentile = Math.min(99, Math.max(1, Math.round(((yCoord + 25) / 50 * 100))));
            const interviewPercentile = Math.min(99, Math.max(1, Math.round(((25 - yCoord) / 50 * 100))));
            
            // 해석 생성
            const xInterpretation = xCoord >= 0 ? 
                '종합형 성향 강함' : 
                '교과형 성향 강함';
            
            const yInterpretation = yCoord >= 0 ? 
                '서류형 성향 강함' : 
                '면접형 성향 강함';
            
            // 결과를 테이블에 표시
            document.getElementById('xCoordValue').textContent = xCoord.toFixed(1);
            document.getElementById('xPercentileValue').textContent = `종합형 ${xPercentile}%, 교과형 ${subjectPercentile}%`;
            document.getElementById('xInterpretation').textContent = xInterpretation;
            
            document.getElementById('yCoordValue').textContent = yCoord.toFixed(1);
            document.getElementById('yPercentileValue').textContent = `서류형 ${yPercentile}%, 면접형 ${interviewPercentile}%`;
            document.getElementById('yInterpretation').textContent = yInterpretation;
            
            // 차트 생성
            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: '학생 위치',
                            data: [{ x: xCoord, y: yCoord }],
                            backgroundColor: 'rgba(255, 99, 132, 1)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            pointRadius: 10,
                            pointHoverRadius: 12
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            min: -25,
                            max: 25,
                            title: { 
                                display: true, 
                                text: '교과형(-) ⟷ 종합형(+)', 
                                font: { weight: 'bold' } 
                            },
                            grid: {
                                color: context => context.tick.value === 0 ? 'rgba(0, 0, 0, 0.5)' : 'rgba(0, 0, 0, 0.1)',
                                lineWidth: context => context.tick.value === 0 ? 2 : 1
                            }
                        },
                        y: {
                            min: -25,
                            max: 25,
                            title: { 
                                display: true, 
                                text: '면접형(-) ⟷ 서류형(+)', 
                                font: { weight: 'bold' } 
                            },
                            grid: {
                                color: context => context.tick.value === 0 ? 'rgba(0, 0, 0, 0.5)' : 'rgba(0, 0, 0, 0.1)',
                                lineWidth: context => context.tick.value === 0 ? 2 : 1
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: '교과형-종합형 / 면접형-서류형 분석',
                            font: { size: 16, weight: 'bold' }
                        },
                        datalabels: {
                            display: true,
                            formatter: () => studentName,
                            font: { weight: 'bold' },
                            offset: 10,
                            anchor: 'center',
                            align: 'top'
                        }
                    }
                }
            });
        }
        
        // 학업성취도 차트 생성
        function createAcademicChart(studentData) {
            const ctx = document.getElementById('academicChart').getContext('2d');
            
            // 임의의 평균 점수 설정 (실제 데이터가 없으므로)
            const averageScores = {
                english: 25, // 영어 평균 점수
                math: 28    // 수학 평균 점수
            };
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['영어', '수학'],
                    datasets: [
                        {
                            label: '점수',
                            data: [
                                studentData.academicData.english.score,
                                studentData.academicData.math.score
                            ],
                            backgroundColor: [
                                'rgba(25, 62, 115, 0.7)',
                                'rgba(25, 62, 115, 0.7)'
                            ],
                            borderColor: [
                                'rgb(25, 62, 115)',
                                'rgb(25, 62, 115)'
                            ],
                            borderWidth: 1
                        },
                        {
                            label: '전체평균',
                            data: [
                                averageScores.english,
                                averageScores.math
                            ],
                            backgroundColor: [
                                'rgba(201, 203, 207, 0.5)',
                                'rgba(201, 203, 207, 0.5)'
                            ],
                            borderColor: [
                                'rgb(201, 203, 207)',
                                'rgb(201, 203, 207)'
                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 50,
                            title: { 
                                display: true, 
                                text: '점수', 
                                font: { weight: 'bold' } 
                            }
                        },
                        x: {
                            title: { 
                                display: true, 
                                text: '교과목', 
                                font: { weight: 'bold' } 
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: '학업성취도 분석',
                            font: { size: 16, weight: 'bold' }
                        },
                        
                        datalabels: {
                            display: (context) => context.datasetIndex === 0, // 첫 번째 데이터셋(학생 점수)에만 표시
                            anchor: 'end',
                            align: 'top',
                            formatter: (value, context) => {
                                const zScore = context.dataIndex === 0 ? 
                                    studentData.academicData.english.zScore : 
                                    studentData.academicData.math.zScore;
                                const percentile = calculatePercentile(zScore);
                                return `${value}점\n상위 ${(100 - percentile).toFixed(1)}%`;
                            },
                            font: { weight: 'bold', size: 12 }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
